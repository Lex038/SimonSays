<div id="simon-game" style="text-align:center; margin:20px;">
  <h2>Simon Says</h2>
  <p>Klik op "Start" en volg het patroon!</p>
  <button onclick="startGame()">Start</button>
  <div style="display:grid;grid-template-columns:repeat(2,150px);gap:10px;justify-content:center;margin-top:20px;">
    <div id="green" class="btn" style="width:150px;height:150px;background:green;opacity:0.8;"></div>
    <div id="red" class="btn" style="width:150px;height:150px;background:red;opacity:0.8;"></div>
    <div id="yellow" class="btn" style="width:150px;height:150px;background:gold;opacity:0.8;"></div>
    <div id="blue" class="btn" style="width:150px;height:150px;background:blue;opacity:0.8;"></div>
  </div>

  <!-- üî• Progress bar -->
  <div id="progress-container" style="width:80%;height:20px;background:#ddd;border-radius:10px;margin:20px auto;overflow:hidden;">
    <div id="progress-bar" style="height:100%;width:0%;background:linear-gradient(90deg, #4caf50, #81c784);transition:width 0.5s;"></div>
  </div>

  <p id="status" style="margin-top:15px;font-weight:bold;"></p>
</div>

<script>
  const buttons = ["green", "red", "yellow", "blue"];
  let sequence = [];
  let playerSequence = [];
  let level = 0;
  let gameActive = false;

  const goalLevel = 18;

  const sounds = {
    green: 523.25,  // C5
    red: 587.33,    // D5
    yellow: 659.25, // E5
    blue: 659.25
  };

  function playSound(color) {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();

    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);

    oscillator.type = "sine";
    oscillator.frequency.value = sounds[color];
    oscillator.start();

    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.6);

    oscillator.stop(audioCtx.currentTime + 0.6);
  }

  function startGame() {
    sequence = [];
    playerSequence = [];
    level = 0;
    gameActive = true;
    updateProgress();
    nextRound();
  }

  function nextRound() {
    if (!gameActive) return;

    playerSequence = [];
    level++;
    document.getElementById("status").textContent = "Level " + level;

    // update progress bar
    updateProgress();

    // Winconditie (nu 18)
    if (level > goalLevel) {
      gameActive = false;
      alert("Wanneer de klok negen slaat en avond in het duister baadt,\n" +
            "verschijnt de haan met vurig kam, die waakt waar voor hem stilte kwam.\n" +
            "Wie hem ontmoet op 't uur der nacht, zal dragen last tot morgengracht.");
      document.getElementById("status").textContent = "Je hebt het raadsel onthuld!";
      return;
    }

    const nextColor = buttons[Math.floor(Math.random() * 4)];
    sequence.push(nextColor);
    playSequence();
  }

  function playSequence() {
    let i = 0;
    const interval = setInterval(() => {
      highlight(sequence[i]);
      playSound(sequence[i]);
      i++;
      if (i >= sequence.length) clearInterval(interval);
    }, 500); // ‚ö°Ô∏è 2x zo snel
  }

  function highlight(color) {
    const el = document.getElementById(color);
    el.style.opacity = "1";
    setTimeout(() => { el.style.opacity = "0.8"; }, 500);
  }

  document.querySelectorAll(".btn").forEach(btn => {
    btn.addEventListener("click", e => {
      if (!gameActive) return;
      const color = e.target.id;
      playerSequence.push(color);
      highlight(color);
      playSound(color);
      checkInput();
    });
  });

  function checkInput() {
    const idx = playerSequence.length - 1;
    if (playerSequence[idx] !== sequence[idx]) {
      document.getElementById("status").textContent = "‚ùå Fout! Probeer opnieuw.";
      gameActive = false;
      return;
    }
    if (playerSequence.length === sequence.length) {
      setTimeout(nextRound, 800);
    }
  }

  function updateProgress() {
    const progress = Math.min(level / goalLevel * 100, 100);
    document.getElementById("progress-bar").style.width = progress + "%";
  }
</script>
