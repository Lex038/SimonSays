<style>
  /* Glow + scale animatie */
  .btn {
    transition: transform 0.2s, opacity 0.2s, box-shadow 0.2s;
    border-radius: 15px;
  }

  .btn.active {
    opacity: 1 !important;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.9);
  }
</style>

<script>
  const buttons = ["green", "red", "yellow", "blue"];
  let sequence = [];
  let playerSequence = [];
  let level = 0;
  let gameActive = false;

  const goalLevel = 18;

  const sounds = {
    green: 523.25,  // C5
    red: 587.33,    // D5
    yellow: 659.25, // E5
    blue: 659.25
  };

  const waveforms = {
    green: "sine",
    red: "square",
    yellow: "triangle",
    blue: "sawtooth"
  };

  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  function playSound(color) {
    if (audioCtx.state === "suspended") {
      audioCtx.resume();
    }

    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();

    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);

    oscillator.type = waveforms[color];
    oscillator.frequency.value = sounds[color];
    oscillator.start();

    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.6);

    oscillator.stop(audioCtx.currentTime + 0.6);
  }

  function startGame() {
    sequence = [];
    playerSequence = [];
    level = 0;
    gameActive = true;
    updateProgress();
    nextRound();
  }

  function nextRound() {
    if (!gameActive) return;

    playerSequence = [];
    level++;
    document.getElementById("status").textContent = "Level " + level;
    updateProgress();

    if (level > goalLevel) {
      gameActive = false;
      alert("Wanneer de klok negen slaat en avond in het duister baadt,\n" +
            "verschijnt de haan met vurig kam, die waakt waar voor hem stilte kwam.\n" +
            "Wie hem ontmoet op 't uur der nacht, zal dragen last tot morgengracht.");
      document.getElementById("status").textContent = "Je hebt het raadsel onthuld!";
      return;
    }

    const nextColor = buttons[Math.floor(Math.random() * 4)];
    sequence.push(nextColor);
    playSequence();
  }

  function playSequence() {
    let i = 0;
    const interval = setInterval(() => {
      highlight(sequence[i]);
      playSound(sequence[i]);
      i++;
      if (i >= sequence.length) clearInterval(interval);
    }, 500);
  }

  function highlight(color) {
    const el = document.getElementById(color);
    el.classList.add("active");
    setTimeout(() => {
      el.classList.remove("active");
    }, 500);
  }

  document.querySelectorAll(".btn").forEach(btn => {
    btn.addEventListener("click", e => {
      if (!gameActive) return;
      const color = e.target.id;
      playerSequence.push(color);
      highlight(color);
      playSound(color);
      checkInput();
    });
  });

  function checkInput() {
    const idx = playerSequence.length - 1;
    if (playerSequence[idx] !== sequence[idx]) {
      document.getElementById("status").textContent = "‚ùå Fout! Probeer opnieuw.";
      gameActive = false;
      return;
    }
    if (playerSequence.length === sequence.length) {
      setTimeout(nextRound, 800);
    }
  }

  function updateProgress() {
    const progress = Math.min(level / goalLevel * 100, 100);
    document.getElementById("progress-bar").style.width = progress + "%";
  }
</script>
